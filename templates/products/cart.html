{% extends 'base.html' %}

{% block content %}
<style>
  .cart-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
    border-radius: 1.5rem;
    padding: 2.5rem 2rem;
    color: white;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  }

  .cart-item-card {
    border: none;
    border-radius: 1rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .cart-item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  }

  .cart-image {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 0.75rem;
  }

  .quantity-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .quantity-btn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .quantity-btn:hover {
    background: #667eea;
    color: white;
    transform: scale(1.1);
  }

  .quantity-display {
    font-size: 1.2rem;
    font-weight: 700;
    min-width: 40px;
    text-align: center;
  }

  .btn-remove {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    border: none;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-remove:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
    color: white;
  }

  .btn-action {
    border-radius: 0.75rem;
    padding: 1rem 2rem;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.3s ease;
  }

  .btn-continue {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
  }

  .btn-continue:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    color: white;
  }

  .btn-clear {
    background: white;
    color: #dc3545;
    border: 2px solid #dc3545;
  }

  .btn-clear:hover {
    background: #dc3545;
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3);
  }

  .empty-cart {
    text-align: center;
    padding: 4rem 2rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border-radius: 1.5rem;
  }

  .empty-cart-icon {
    font-size: 6rem;
    margin-bottom: 1.5rem;
    opacity: 0.7;
  }
</style>

<div class="cart-header animate__animated animate__fadeInDown">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="mb-2">üõí Your Shopping Cart</h1>
      <p class="mb-0 opacity-90">Review your selected products</p>
    </div>
    <div class="text-end">
      <div class="fs-3 fw-bold">{{ cart.get_total_items }} Items</div>
    </div>
  </div>
</div>

{% if messages %}
<div class="container mb-3">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }} alert-dismissible fade show animate__animated animate__fadeInDown" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endfor %}
</div>
{% endif %}

{% if cart_items %}
<div class="row">
  <div class="col-lg-8">
    {% for item in cart_items %}
    <div class="card cart-item-card animate__animated animate__fadeInUp">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-3">
            {% if item.product.image %}
              <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="cart-image">
            {% else %}
              <div class="cart-image d-flex align-items-center justify-content-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 3rem;">
                üíß
              </div>
            {% endif %}
          </div>
          <div class="col-md-5">
            <h5 class="fw-bold mb-1" style="color: #667eea;">{{ item.product.brand }}</h5>
            <h6 class="text-muted mb-2">{{ item.product.name }}</h6>
            <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
              {{ item.product.skin_type|title }}
            </span>
            <span class="badge bg-light text-dark">{{ item.product.product_type }}</span>
          </div>
          <div class="col-md-4">
            <div class="d-flex flex-column gap-3">
              <form method="POST" action="{% url 'update_cart' item.id %}" class="quantity-control">
                {% csrf_token %}
                <button type="submit" name="action" value="decrease" class="quantity-btn">‚àí</button>
                <div class="quantity-display">{{ item.quantity }}</div>
                <button type="submit" name="action" value="increase" class="quantity-btn">+</button>
              </form>
              <form method="POST" action="{% url 'update_cart' item.id %}">
                {% csrf_token %}
                <button type="submit" name="action" value="remove" class="btn btn-remove w-100">
                  üóëÔ∏è Remove
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="col-lg-4">
    <div class="card border-0 shadow-lg sticky-top" style="top: 100px; border-radius: 1.5rem;">
      <div class="card-body p-4">
        <h4 class="fw-bold mb-4" style="color: #667eea;">Cart Summary</h4>
        <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
          <span class="fs-5">Total Items:</span>
          <span class="fs-5 fw-bold">{{ cart.get_total_items }}</span>
        </div>
        <div class="d-grid gap-3 mt-4">
          <a href="{% url 'checkout' %}" class="btn btn-action btn-continue" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; font-weight: 700; padding: 1rem; border-radius: 0.75rem; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;">
            üõçÔ∏è Proceed to Buy
          </a>
          <a href="{% url 'product_list' %}" class="btn btn-action btn-continue">
            ‚Üê Continue Shopping
          </a>
          <form method="POST" action="{% url 'clear_cart' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-action btn-clear w-100" onclick="return confirm('Are you sure you want to clear your cart?')">
              üóëÔ∏è Clear Cart
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
<div class="empty-cart animate__animated animate__fadeIn">
  <div class="empty-cart-icon">üõí</div>
  <h2 class="mb-3" style="color: #667eea;">Your cart is empty</h2>
  <p class="text-muted mb-4">Start adding products to your cart!</p>
  <a href="{% url 'product_list' %}" class="btn btn-action btn-continue">
    üå∏ Browse Products
  </a>
</div>
{% endif %}

<div class="row mt-5 mb-4">
  <div class="col-12 text-center">
    <a href="{% url 'dashboard' %}" class="btn btn-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 0.75rem; padding: 1rem 2.5rem; font-weight: 600;">
      ‚Üê Back to Dashboard
    </a>
  </div>
</div>
{% endblock %}
